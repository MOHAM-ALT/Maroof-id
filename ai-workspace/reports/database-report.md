# ุชูุฑูุฑ ูุญุต ููุงุนุฏ ุงูุจูุงูุงุช (Database Audit Report)
# ุงูุชุงุฑูุฎ: 2026-02-25

ุชู ุฅุฌุฑุงุก ูุญุต ุดุงูู ููููู ููุงุนุฏ ุงูุจูุงูุงุชุ ุงูุนูุงูุงุชุ ูุงูููุงุฑุณ ูู ูุดุฑูุน "ูุนุฑูู".

---

## 1. ุชุญููู ุงููููู ุงูุญุงูู (Current Schema Analysis) ๐

### 1.1 ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
ุงููุดุฑูุน ูุญุชูู ุนูู ูููู ูุชูุงูู ูุบุทู ูุงูุฉ ุฌูุงูุจ ุงูู SaaS:
*   **ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ:** `users`, `roles`, `permissions`.
*   **ุงูุจุทุงูุงุช ุงูุฑูููุฉ:** `cards`, `card_views`, `card_social_links`.
*   **ุงูููุงูุจ ูุงูุชุตููู:** `templates`, `template_categories`.
*   **ุงูุชุฌุงุฑุฉ ูุงููุงููุฉ:** `orders`, `transactions`, `payouts`, `coupons`.
*   **ุงูุดุฑูุงุก ูุงูููุฒุนูู:** `partners`, `resellers`, `affiliates`.

### 1.2 ุงูุนูุงูุงุช (Relationships)
*   ุชู ุงุณุชุฎุฏุงู ุงูุนูุงูุงุช ุจุดูู ุตุญูุญ ูู ุฃุบูุจ ุงูุฌุฏุงูู (One-to-Many ุจูู ุงููุณุชุฎุฏู ูุงูุจุทุงูุงุชุ Many-to-Many ูู ุงูุฃุฏูุงุฑ).
*   ููุฌุฏ ุงุณุชุฎุฏุงู ุฌูุฏ ูู `SoftDeletes` ูู ุฌุฏูู ุงูุจุทุงูุงุช (`cards`) ูุถูุงู ุนุฏู ููุฏุงู ุงูุจูุงูุงุช.

---

## 2. ุงููุดุงูู ูุงูุซุบุฑุงุช ุงูููุชุดูุฉ (Critical Issues Found) ๐ฉ

### 2.1 ุฃุนูุฏุฉ ููููุฏุฉ (Missing Columns)
ุฃุซูุงุก ูุญุต ุงูููุฏ ุงูุจุฑูุฌู ูููุงุฑูุชู ุจุงูููุงุฌุฑูู (Migrations)ุ ุชุจูู ูุฌูุฏ ูุฌูุงุช ุฎุทูุฑุฉ:
*   **ุญูู `wallet_balance`:** ูุณุชุฎุฏู ูู `PaymentService.php` ูุฎุตู ุงูุฑุตูุฏ ูู ูุญูุธุฉ ุงููุณุชุฎุฏูุ ููููู **ุบูุฑ ููุฌูุฏ** ูู ุฌุฏูู `users` ุฃู ุฃู ุฌุฏูู ูุฑุชุจุท. ูุฐุง ุณูุคุฏู ููุดู ุนูููุงุช ุงูุฏูุน ุนุจุฑ ุงููุญูุธุฉ.
*   **ุญูู `phone`:** ุชู ุฅุถุงูุชู ูุงุญูุงู ูู Migration ูููุตูุ ูููู ุจุนุถ ูููุงุช ุงูู `Factory` ู `Seeders` ูุฏ ูุง ุชุฒุงู ุชูุชูุฑ ุฅููู.

### 2.2 ูุดุงูู ูู ุงูุชูุงุณู (Inconsistency)
*   **ุชุนุฏุฏ ุงูุนููุงุช:** ุฌุฏูู `transactions` ูุญุชูู ุนูู ุญูู `currency` ูููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูุงูููุทู ุงูุจุฑูุฌู ููุชุฑุถ ุฏุงุฆูุงู `SAR`. ููุถู ุชูุญูุฏู ุฃู ุฌุนูู ูุงุจูุงู ููุชุบููุฑ ูู ุงูุฅุนุฏุงุฏุงุช.
*   **ุชูุฑุงุฑ ุงูุจูุงูุงุช:** ูุชู ุชุฎุฒูู ุจูุงูุงุช ุงูุชุตููู ูู ุญูููู `design_settings` ู `design_data` ูู ุฌุฏูู `cards`. ููุถู ุฏูุฌูู ูู ุญูู JSON ูุงุญุฏ ูุชูููู ุงูุชุนููุฏ.

---

## 3. ูุญุต ุงูุฃุฏุงุก ูุงูููุงุฑุณ (Performance & Indexing) โก

*   **ุงูููุงุฑุณ ุงูููููุฏุฉ:** ุฌุฏุงูู ูุซู `card_views` ู `affiliate_clicks` ุณุชููู ุจุณุฑุนุฉ ูุจูุฑุฉ. ุชุญุชุงุฌ ูููุงุฑุณ ูุฑูุจุฉ (Composite Indexes) ุนูู `(card_id, created_at)` ู `(ip_address)` ูุชุญุณูู ุณุฑุนุฉ ุงูุชูุงุฑูุฑ.
*   **ุญุฌู ุงูุจูุงูุงุช:** ุญูู `html_content` ูู ุฌุฏูู `templates` ูุฏ ูุตุจุญ ูุจูุฑุงู ุฌุฏุงู. ููุถู ุงูุชุฃูุฏ ูู ููุน ุงูุญูู `MEDIUMTEXT` ุฃู `LONGTEXT`.

---

## 4. ุงูุชูุตูุงุช (Recommendations) ๐

1.  **ุฅุตูุงุญ ููุฑู:** ุฅุถุงูุฉ ุญูู `wallet_balance` ูููุน `decimal(15,2)` ูู ุฌุฏูู ุงููุณุชุฎุฏููู.
2.  **ุชุญุณูู ุงูุนูุงูุงุช:** ุฅุถุงูุฉ `onDelete('cascade')` ููุนูุงูุงุช ุงููุงูุฉ ูุถูุงู ูุธุงูุฉ ุงูุจูุงูุงุช ุนูุฏ ุญุฐู ุงููุณุชุฎุฏููู.
3.  **ุงูุฃุฑุดูุฉ:** ุฅูุดุงุก ูุธุงู ุฃุฑุดูุฉ ุฏูุฑู ูุฌุฏูู `card_views` ูุฃูู ูุฏ ูุณุจุจ ุจุทุก ูู ุงููุธุงู ูุณุชูุจูุงู.
4.  **ุงูุชูุซูู:** ุงุณุชุฎุฏุงู `DB Comment` ูู ุงูู Migrations ูุดุฑุญ ูุธููุฉ ูู ุญูู ุจุฑูุฌูุงู.

---
*ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ูุถูุงู ุงุณุชูุฑุงุฑ ูุณูุงูุฉ ุงูุจูุงูุงุช ูู ุงููุดุฑูุน.*
